machine:
  node:
    version: 6
  environment:
    DEV_S3_BUCKET: avraammavridis.com

checkout:
  override:
    - git clone -b ${CIRCLE_BRANCH} --depth 1 https://github.com/AvraamMavridis/${CIRCLE_PROJECT_REPONAME}

test:
  override:
    - echo cool

deployment:
  production:
    branch: master
    commands:
      - npm run build:production
      - aws s3 rm s3://${DEV_S3_BUCKET} --recursive
      - aws s3 sync build s3://${DEV_S3_BUCKET} --acl public-read --cache-control "public, max-age=10" --include "*" --exclude "*.html" --exclude "*.css" --exclude "*.js" --exclude "*.png" --exclude "*.jpg" --exclude "*.woff" --exclude "*.json" --exclude "*.ico" --exclude "*.svg" --exclude "*.otf" --exclude "*.woff2"
      - aws s3 sync build s3://${DEV_S3_BUCKET} --acl public-read --cache-control "public, max-age=864000" --exclude "*" --include "*.png" --include "*.jpg" --include "*.woff" --include "*.ico" --include "*.otf" --include "*.woff2"
      - aws s3 sync build s3://${DEV_S3_BUCKET} --content-encoding "gzip" --acl public-read --cache-control "public, max-age=10" --exclude "*" --include "*.html" --include "*.json"
      - aws s3 sync build s3://${DEV_S3_BUCKET} --content-encoding "gzip" --acl public-read --cache-control "public, max-age=864000" --exclude "*" --include "*.js" --include "*.css" --include "*.svg" --include "*.ico"
